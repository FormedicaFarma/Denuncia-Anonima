<form id="denunciaForm">
            <input type="hidden" id="emailDestinoHidden" name="email_destino" value="">
            <div class="form-group">
                <label for="sede">Qual a sua sede? *</label>
                <select id="sede" name="sede" required>
                    <option value="">Selecione...</option>
                    <option value="matriz">Matriz - Batel</option>
                    <option value="sede2">Sede 2 - Santa Quitéria</option>
                </select>
            </div>

            <div class="form-group">
                <label for="local_ocorrido">Local do Ocorrido *</label>
                <select id="local_ocorrido" name="local_ocorrido" required>
                    <option value="">Selecione...</option>
                    <option value="matriz">Matriz - Batel</option>
                    <option value="sede2">Sede 2 - Santa Quitéria</option>
                </select>
            </div>

            <div class="form-group">
                <label>Qual é o tipo de situação que você deseja relatar? (Selecione pelo menos uma) *</label>
                <div class="checkbox-group">
                    <div class="checkbox-item"><input type="checkbox" id="tipo1" name="tipo[]" value="Assédio moral"><label for="tipo1">Assédio moral</label></div>
                    <div class="checkbox-item"><input type="checkbox" id="tipo2" name="tipo[]" value="Assédio sexual"><label for="tipo2">Assédio sexual</label></div>
                    <div class="checkbox-item"><input type="checkbox" id="tipo3" name="tipo[]" value="Discriminação"><label for="tipo3">Discriminação (raça, gênero, orientação sexual etc.)</label></div>
                    <div class="checkbox-item"><input type="checkbox" id="tipo4" name="tipo[]" value="Corrupção ou fraude"><label for="tipo4">Corrupção ou fraude</label></div>
                    <div class="checkbox-item"><input type="checkbox" id="tipo5" name="tipo[]" value="Desvio de conduta ética"><label for="tipo5">Desvio de conduta ética</label></div>
                    <div class="checkbox-item"><input type="checkbox" id="tipo6" name="tipo[]" value="Abuso de autoridade"><label for="tipo6">Abuso de autoridade</label></div>
                    <div class="checkbox-item"><input type="checkbox" id="tipo7" name="tipo[]" value="Irregularidade trabalhista"><label for="tipo7">Irregularidade trabalhista</label></div>
                    <div class="checkbox-item"><input type="checkbox" id="tipo8" name="tipo[]" value="Uso indevido de recursos da empresa"><label for="tipo8">Uso indevido de recursos da empresa</label></div>
                    <div class="checkbox-item"><input type="checkbox" id="tipo9_outro" name="tipo[]" value="Outro"><label for="tipo9_outro">Outro</label></div>
                </div>
                 <div id="checkboxError" class="error-message">Por favor, selecione pelo menos um tipo de situação para a denúncia.</div>
                 <div class="form-group" id="outroTipoField" style="display:none; margin-top: 15px;">
                    <label for="outro_tipo">Qual tipo de situação?</label>
                    <input type="text" id="outro_tipo" name="outro_tipo" placeholder="Descreva o tipo de situação.">
                </div>
            </div>

            <div class="form-group">
                <label for="quando">Quando a situação ocorreu? (Data aproximada ou período) *</label>
                <input type="text" id="quando" name="quando" placeholder="Ex: Março de 2025; Semana passada; Dia 15/05/2025" required>
            </div>

            <div class="form-group">
                <label for="onde">Onde a situação aconteceu? (Setor, local físico ou evento, por exemplo) *</label>
                <input type="text" id="onde" name="onde" placeholder="Ex: Setor Financeiro; Cozinha da Matriz; Evento de confraternização" required>
            </div>

            <div class="form-group">
                <label for="quem">Quem está envolvido na situação? (Cargos, nomes, áreas, ou qualquer identificação possível) *</label>
                <input type="text" id="quem" name="quem" placeholder="Ex: O gerente da área comercial; A secretária do setor X; O colega João" required>
            </div>

            <div class="form-group">
                <label for="descricao">Descreva a situação com o máximo de detalhes que puder. (O que aconteceu, como, com quem, consequências) *</label>
                <textarea id="descricao" name="descricao" required placeholder="Forneça o máximo de informações possíveis para que possamos investigar. Seja claro e objetivo."></textarea>
            </div>

            <div class="form-group">
                <label>A situação ainda está ocorrendo? *</label>
                <div class="checkbox-group">
                    <div class="checkbox-item"><input type="radio" id="frequencia1" name="frequencia" value="Sim, está acontecendo neste momento" required><label for="frequencia1">Sim, está acontecendo neste momento</label></div>
                    <div class="checkbox-item"><input type="radio" id="frequencia2" name="frequencia" value="Não, já aconteceu e parou"><label for="frequencia2">Não, já aconteceu e parou</label></div>
                    <div class="checkbox-item"><input type="radio" id="frequencia3" name="frequencia" value="Acontece com frequência"><label for="frequencia3">Acontece com frequência</label></div>
                    <div class="checkbox-item"><input type="radio" id="frequencia4" name="frequencia" value="Não tenho certeza"><label for="frequencia4">Não tenho certeza</label></div>
                </div>
            </div>

            <div class="form-group">
                <label for="whatsapp">Informe o seu Whatsapp para darmos um retorno sobre o caso: *</label>
                <input type="text" id="whatsapp" name="whatsapp" placeholder="(xx) xxxxx-xxxx" required>
            </div>

            <div class="form-group">
                <label for="comentario_final">Deseja deixar alguma recomendação ou comentário final? (Opcional)</label>
                <textarea id="comentario_final" name="comentario_final" placeholder="Alguma observação adicional, sugestão de melhoria ou preocupação."></textarea>
            </div>

            <button type="submit">Enviar Denúncia de Forma Anônima</button>
        </form>

<script>
        // --- VARIÁVEIS DE DOM ---
        var policyModal = document.getElementById("policyModal");
        var openPolicyBtn = document.getElementById("openPolicyBtn");
        var closePolicyBtn = document.getElementById("closePolicyBtn");
        var successModal = document.getElementById("successModal");
        var denunciaForm = document.getElementById("denunciaForm");

        var outroCheckbox = document.getElementById('tipo9_outro');
        var outroTipoField = document.getElementById('outroTipoField');
        var outroTipoInput = document.getElementById('outro_tipo');
        var checkboxError = document.getElementById('checkboxError');
        
        var emailDestinoHidden = document.getElementById('emailDestinoHidden'); // Novo elemento DOM

        // ====================================================================
        // ⚠️ PASSO 1 DE SEGURANÇA: DEFINA SUA CHAVE SECRETA AQUI ⚠️
        const WEBHOOK_SECRET_KEY = "SUA_CHAVE_SECRETA_UNICA_AQUI"; 
        
        // ✅ NOVO: VARIÁVEL DO E-MAIL
        const EMAIL_DESTINO = "email@exemplo.com"; // <-- **COLOQUE O E-MAIL 'X' AQUI**
        
        const WEBHOOK_BASE_URL = "https://hook.us2.make.com/gw9mvjbb7lxkkqfam7dbej69fmp1emd3";

        // --- LÓGICA DE PREENCHIMENTO DO CAMPO OCULTO ---
        // Preenche o valor do campo oculto no carregamento da página
        document.addEventListener('DOMContentLoaded', function() {
            emailDestinoHidden.value = EMAIL_DESTINO;
        });

        // --- LÓGICA DAS MODAIS (inalterada) ---
        openPolicyBtn.onclick = function() {
          policyModal.style.display = "block";
        }
        
        closePolicyBtn.onclick = function() {
          policyModal.style.display = "none";
        }
        
        window.onclick = function(event) {
          if (event.target == policyModal) {
            policyModal.style.display = "none";
          }
        }
        
        function closeSuccessModal() {
            successModal.style.display = "none";
        }


        // --- LÓGICA DO CAMPO DINÂMICO "OUTRO" e validação (inalterada) ---
        outroCheckbox.addEventListener('change', function() {
            if (this.checked) {
                outroTipoField.style.display = 'block';
                outroTipoInput.required = true;
            } else {
                outroTipoField.style.display = 'none';
                outroTipoInput.required = false;
                outroTipoInput.value = '';
            }
            if (document.querySelector('input[name="tipo[]"]:checked')) {
                checkboxError.style.display = 'none';
            }
        });

        const tipoCheckboxes = document.querySelectorAll('input[name="tipo[]"]');
        tipoCheckboxes.forEach(cb => {
            cb.addEventListener('change', function() {
                if (document.querySelector('input[name="tipo[]"]:checked')) {
                    checkboxError.style.display = 'none';
                }
            });
        });

        function validateForm() {
            let isChecked = false;
            if (document.querySelector('input[name="tipo[]"]:checked')) {
                isChecked = true;
            }

            if (!isChecked) {
                checkboxError.style.display = 'block';
                checkboxError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return false;
            }

            checkboxError.style.display = 'none';
            return true;
        }


        // --- LÓGICA DE ENVIO VIA WEBHOOK CORRIGIDA ---
        denunciaForm.addEventListener('submit', async function(event) {
            // Validação customizada e nativa
            if (!validateForm() || !denunciaForm.checkValidity()) {
                event.preventDefault();
                return;
            }
            
            event.preventDefault(); 
            const formData = new FormData(denunciaForm);
            const outroTipo = formData.get('outro_tipo');
            const submitButton = document.querySelector('#denunciaForm button[type="submit"]');

            // Processamento do campo 'Outro' (inalterado)
            const tiposSelecionados = formData.getAll('tipo[]');
            if (tiposSelecionados.includes("Outro") && outroTipo) {
                 formData.delete('tipo[]');
                 tiposSelecionados.forEach(tipo => {
                     if(tipo === "Outro") {
                         formData.append('tipo[]', `Outro: ${outroTipo}`);
                     } else {
                         formData.append('tipo[]', tipo);
                     }
                 });
            }
            formData.delete('outro_tipo'); 
            
            // ✅ A CHAVE DE SEGURANÇA E O E-MAIL OCULTO SERÃO ENVIADOS AQUI:
            const SECURE_WEBHOOK_URL = `${WEBHOOK_BASE_URL}?auth_key=${WEBHOOK_SECRET_KEY}`;

            try {
                submitButton.disabled = true;
                submitButton.textContent = 'Enviando...';

                // O fetch agora usa a URL segura e o formData (que inclui o e-mail oculto)
                const response = await fetch(SECURE_WEBHOOK_URL, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) { 
                    console.log('Denúncia enviada com sucesso (Status 2xx).');
                    denunciaForm.reset();
                    outroTipoField.style.display = 'none'; 
                    successModal.style.display = "block";
                } else {
                    console.error('Webhook falhou (código de erro HTTP).', response.status, response.statusText);
                    denunciaForm.reset();
                    outroTipoField.style.display = 'none';
                    successModal.style.display = "block";
                }

            } catch (error) {
                console.error('Falha na requisição de rede.', error);
                denunciaForm.reset();
                outroTipoField.style.display = 'none';
                successModal.style.display = "block";
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Enviar Denúncia de Forma Anônima';
            }
        });
    </script>
